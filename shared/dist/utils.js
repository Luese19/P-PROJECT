"use strict";
/**
 * Utility functions for the Jeep-Track application
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateDistance = calculateDistance;
exports.calculateBearing = calculateBearing;
exports.formatDistance = formatDistance;
exports.calculateETA = calculateETA;
exports.formatETA = formatETA;
exports.debounce = debounce;
exports.throttle = throttle;
exports.isValidCoordinate = isValidCoordinate;
exports.isInPhilippines = isInPhilippines;
/**
 * Calculate distance between two coordinates using Haversine formula
 * @param lat1 Latitude of first point
 * @param lon1 Longitude of first point
 * @param lat2 Latitude of second point
 * @param lon2 Longitude of second point
 * @returns Distance in kilometers
 */
function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Earth's radius in km
    const dLat = toRadians(lat2 - lat1);
    const dLon = toRadians(lon2 - lon1);
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(toRadians(lat1)) *
            Math.cos(toRadians(lat2)) *
            Math.sin(dLon / 2) *
            Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
}
/**
 * Convert degrees to radians
 */
function toRadians(degrees) {
    return degrees * (Math.PI / 180);
}
/**
 * Calculate bearing between two coordinates
 * @returns Bearing in degrees (0-360)
 */
function calculateBearing(lat1, lon1, lat2, lon2) {
    const dLon = toRadians(lon2 - lon1);
    const y = Math.sin(dLon) * Math.cos(toRadians(lat2));
    const x = Math.cos(toRadians(lat1)) * Math.sin(toRadians(lat2)) -
        Math.sin(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.cos(dLon);
    const bearing = Math.atan2(y, x);
    return (toDegrees(bearing) + 360) % 360;
}
/**
 * Convert radians to degrees
 */
function toDegrees(radians) {
    return radians * (180 / Math.PI);
}
/**
 * Format distance for display
 */
function formatDistance(km) {
    if (km < 1) {
        return `${Math.round(km * 1000)}m`;
    }
    return `${km.toFixed(1)}km`;
}
/**
 * Calculate ETA in minutes
 * @param distanceKm Distance in kilometers
 * @param speedKph Average speed in km/h
 */
function calculateETA(distanceKm, speedKph) {
    return Math.round((distanceKm / speedKph) * 60);
}
/**
 * Format ETA for display
 */
function formatETA(minutes) {
    if (minutes < 1) {
        return 'Less than a minute';
    }
    if (minutes === 1) {
        return '1 minute';
    }
    if (minutes < 60) {
        return `${minutes} minutes`;
    }
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    if (mins === 0) {
        return `${hours} hour${hours > 1 ? 's' : ''}`;
    }
    return `${hours}h ${mins}m`;
}
/**
 * Debounce function to limit execution rate
 */
function debounce(func, wait) {
    let timeout = null;
    return function executedFunction(...args) {
        const later = () => {
            timeout = null;
            func(...args);
        };
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(later, wait);
    };
}
/**
 * Throttle function to limit execution frequency
 */
function throttle(func, limit) {
    let inThrottle;
    return function executedFunction(...args) {
        if (!inThrottle) {
            func(...args);
            inThrottle = true;
            setTimeout(() => (inThrottle = false), limit);
        }
    };
}
/**
 * Validate coordinate bounds
 */
function isValidCoordinate(lat, lon) {
    return lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180;
}
/**
 * Check if coordinate is within Philippines bounds
 */
function isInPhilippines(lat, lon) {
    return (lat >= 4.58 &&
        lat <= 21.12 &&
        lon >= 116.95 &&
        lon <= 126.6);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQVVILDhDQW1CQztBQWFELDRDQWNDO0FBWUQsd0NBS0M7QUFPRCxvQ0FFQztBQUtELDhCQWdCQztBQUtELDRCQWlCQztBQUtELDRCQWFDO0FBS0QsOENBRUM7QUFLRCwwQ0FPQztBQWhLRDs7Ozs7OztHQU9HO0FBQ0gsU0FBZ0IsaUJBQWlCLENBQy9CLElBQVksRUFDWixJQUFZLEVBQ1osSUFBWSxFQUNaLElBQVk7SUFFWixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyx1QkFBdUI7SUFDdkMsTUFBTSxJQUFJLEdBQUcsU0FBUyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQztJQUNwQyxNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBRXBDLE1BQU0sQ0FBQyxHQUNMLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN2QixJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6QixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7WUFDbEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFFdkIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pELE9BQU8sQ0FB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RyxJQUFJLEtBQUs7UUFDWixHQUFHLElBQUksTUFBTTtRQUNiLEdBQUcsSUFBSSxLQUFLLENBQ2IsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVXRpbGl0eSBmdW5jdGlvbnMgZm9yIHRoZSBKZWVwLVRyYWNrIGFwcGxpY2F0aW9uXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIENhbGN1bGF0ZSBkaXN0YW5jZSBiZXR3ZWVuIHR3byBjb29yZGluYXRlcyB1c2luZyBIYXZlcnNpbmUgZm9ybXVsYVxyXG4gKiBAcGFyYW0gbGF0MSBMYXRpdHVkZSBvZiBmaXJzdCBwb2ludFxyXG4gKiBAcGFyYW0gbG9uMSBMb25naXR1ZGUgb2YgZmlyc3QgcG9pbnRcclxuICogQHBhcmFtIGxhdDIgTGF0aXR1ZGUgb2Ygc2Vjb25kIHBvaW50XHJcbiAqIEBwYXJhbSBsb24yIExvbmdpdHVkZSBvZiBzZWNvbmQgcG9pbnRcclxuICogQHJldHVybnMgRGlzdGFuY2UgaW4ga2lsb21ldGVyc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZURpc3RhbmNlKFxyXG4gIGxhdDE6IG51bWJlcixcclxuICBsb24xOiBudW1iZXIsXHJcbiAgbGF0MjogbnVtYmVyLFxyXG4gIGxvbjI6IG51bWJlclxyXG4pOiBudW1iZXIge1xyXG4gIGNvbnN0IFIgPSA2MzcxOyAvLyBFYXJ0aCdzIHJhZGl1cyBpbiBrbVxyXG4gIGNvbnN0IGRMYXQgPSB0b1JhZGlhbnMobGF0MiAtIGxhdDEpO1xyXG4gIGNvbnN0IGRMb24gPSB0b1JhZGlhbnMobG9uMiAtIGxvbjEpO1xyXG4gIFxyXG4gIGNvbnN0IGEgPVxyXG4gICAgTWF0aC5zaW4oZExhdCAvIDIpICogTWF0aC5zaW4oZExhdCAvIDIpICtcclxuICAgIE1hdGguY29zKHRvUmFkaWFucyhsYXQxKSkgKlxyXG4gICAgICBNYXRoLmNvcyh0b1JhZGlhbnMobGF0MikpICpcclxuICAgICAgTWF0aC5zaW4oZExvbiAvIDIpICpcclxuICAgICAgTWF0aC5zaW4oZExvbiAvIDIpO1xyXG4gIFxyXG4gIGNvbnN0IGMgPSAyICogTWF0aC5hdGFuMihNYXRoLnNxcnQoYSksIE1hdGguc3FydCgxIC0gYSkpO1xyXG4gIHJldHVybiBSICogYztcclxufVxyXG5cclxuLyoqXHJcbiAqIENvbnZlcnQgZGVncmVlcyB0byByYWRpYW5zXHJcbiAqL1xyXG5mdW5jdGlvbiB0b1JhZGlhbnMoZGVncmVlczogbnVtYmVyKTogbnVtYmVyIHtcclxuICByZXR1cm4gZGVncmVlcyAqIChNYXRoLlBJIC8gMTgwKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENhbGN1bGF0ZSBiZWFyaW5nIGJldHdlZW4gdHdvIGNvb3JkaW5hdGVzXHJcbiAqIEByZXR1cm5zIEJlYXJpbmcgaW4gZGVncmVlcyAoMC0zNjApXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQmVhcmluZyhcclxuICBsYXQxOiBudW1iZXIsXHJcbiAgbG9uMTogbnVtYmVyLFxyXG4gIGxhdDI6IG51bWJlcixcclxuICBsb24yOiBudW1iZXJcclxuKTogbnVtYmVyIHtcclxuICBjb25zdCBkTG9uID0gdG9SYWRpYW5zKGxvbjIgLSBsb24xKTtcclxuICBjb25zdCB5ID0gTWF0aC5zaW4oZExvbikgKiBNYXRoLmNvcyh0b1JhZGlhbnMobGF0MikpO1xyXG4gIGNvbnN0IHggPVxyXG4gICAgTWF0aC5jb3ModG9SYWRpYW5zKGxhdDEpKSAqIE1hdGguc2luKHRvUmFkaWFucyhsYXQyKSkgLVxyXG4gICAgTWF0aC5zaW4odG9SYWRpYW5zKGxhdDEpKSAqIE1hdGguY29zKHRvUmFkaWFucyhsYXQyKSkgKiBNYXRoLmNvcyhkTG9uKTtcclxuICBcclxuICBjb25zdCBiZWFyaW5nID0gTWF0aC5hdGFuMih5LCB4KTtcclxuICByZXR1cm4gKHRvRGVncmVlcyhiZWFyaW5nKSArIDM2MCkgJSAzNjA7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb252ZXJ0IHJhZGlhbnMgdG8gZGVncmVlc1xyXG4gKi9cclxuZnVuY3Rpb24gdG9EZWdyZWVzKHJhZGlhbnM6IG51bWJlcik6IG51bWJlciB7XHJcbiAgcmV0dXJuIHJhZGlhbnMgKiAoMTgwIC8gTWF0aC5QSSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGb3JtYXQgZGlzdGFuY2UgZm9yIGRpc3BsYXlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXREaXN0YW5jZShrbTogbnVtYmVyKTogc3RyaW5nIHtcclxuICBpZiAoa20gPCAxKSB7XHJcbiAgICByZXR1cm4gYCR7TWF0aC5yb3VuZChrbSAqIDEwMDApfW1gO1xyXG4gIH1cclxuICByZXR1cm4gYCR7a20udG9GaXhlZCgxKX1rbWA7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDYWxjdWxhdGUgRVRBIGluIG1pbnV0ZXNcclxuICogQHBhcmFtIGRpc3RhbmNlS20gRGlzdGFuY2UgaW4ga2lsb21ldGVyc1xyXG4gKiBAcGFyYW0gc3BlZWRLcGggQXZlcmFnZSBzcGVlZCBpbiBrbS9oXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlRVRBKGRpc3RhbmNlS206IG51bWJlciwgc3BlZWRLcGg6IG51bWJlcik6IG51bWJlciB7XHJcbiAgcmV0dXJuIE1hdGgucm91bmQoKGRpc3RhbmNlS20gLyBzcGVlZEtwaCkgKiA2MCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGb3JtYXQgRVRBIGZvciBkaXNwbGF5XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RVRBKG1pbnV0ZXM6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgaWYgKG1pbnV0ZXMgPCAxKSB7XHJcbiAgICByZXR1cm4gJ0xlc3MgdGhhbiBhIG1pbnV0ZSc7XHJcbiAgfVxyXG4gIGlmIChtaW51dGVzID09PSAxKSB7XHJcbiAgICByZXR1cm4gJzEgbWludXRlJztcclxuICB9XHJcbiAgaWYgKG1pbnV0ZXMgPCA2MCkge1xyXG4gICAgcmV0dXJuIGAke21pbnV0ZXN9IG1pbnV0ZXNgO1xyXG4gIH1cclxuICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IobWludXRlcyAvIDYwKTtcclxuICBjb25zdCBtaW5zID0gbWludXRlcyAlIDYwO1xyXG4gIGlmIChtaW5zID09PSAwKSB7XHJcbiAgICByZXR1cm4gYCR7aG91cnN9IGhvdXIke2hvdXJzID4gMSA/ICdzJyA6ICcnfWA7XHJcbiAgfVxyXG4gIHJldHVybiBgJHtob3Vyc31oICR7bWluc31tYDtcclxufVxyXG5cclxuLyoqXHJcbiAqIERlYm91bmNlIGZ1bmN0aW9uIHRvIGxpbWl0IGV4ZWN1dGlvbiByYXRlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZGVib3VuY2U8VCBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gYW55PihcclxuICBmdW5jOiBULFxyXG4gIHdhaXQ6IG51bWJlclxyXG4pOiAoLi4uYXJnczogUGFyYW1ldGVyczxUPikgPT4gdm9pZCB7XHJcbiAgbGV0IHRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XHJcbiAgXHJcbiAgcmV0dXJuIGZ1bmN0aW9uIGV4ZWN1dGVkRnVuY3Rpb24oLi4uYXJnczogUGFyYW1ldGVyczxUPikge1xyXG4gICAgY29uc3QgbGF0ZXIgPSAoKSA9PiB7XHJcbiAgICAgIHRpbWVvdXQgPSBudWxsO1xyXG4gICAgICBmdW5jKC4uLmFyZ3MpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgaWYgKHRpbWVvdXQpIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xyXG4gICAgfVxyXG4gICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUaHJvdHRsZSBmdW5jdGlvbiB0byBsaW1pdCBleGVjdXRpb24gZnJlcXVlbmN5XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdGhyb3R0bGU8VCBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gYW55PihcclxuICBmdW5jOiBULFxyXG4gIGxpbWl0OiBudW1iZXJcclxuKTogKC4uLmFyZ3M6IFBhcmFtZXRlcnM8VD4pID0+IHZvaWQge1xyXG4gIGxldCBpblRocm90dGxlOiBib29sZWFuO1xyXG4gIFxyXG4gIHJldHVybiBmdW5jdGlvbiBleGVjdXRlZEZ1bmN0aW9uKC4uLmFyZ3M6IFBhcmFtZXRlcnM8VD4pIHtcclxuICAgIGlmICghaW5UaHJvdHRsZSkge1xyXG4gICAgICBmdW5jKC4uLmFyZ3MpO1xyXG4gICAgICBpblRocm90dGxlID0gdHJ1ZTtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiAoaW5UaHJvdHRsZSA9IGZhbHNlKSwgbGltaXQpO1xyXG4gICAgfVxyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSBjb29yZGluYXRlIGJvdW5kc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRDb29yZGluYXRlKGxhdDogbnVtYmVyLCBsb246IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gIHJldHVybiBsYXQgPj0gLTkwICYmIGxhdCA8PSA5MCAmJiBsb24gPj0gLTE4MCAmJiBsb24gPD0gMTgwO1xyXG59XHJcblxyXG4vKipcclxuICogQ2hlY2sgaWYgY29vcmRpbmF0ZSBpcyB3aXRoaW4gUGhpbGlwcGluZXMgYm91bmRzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNJblBoaWxpcHBpbmVzKGxhdDogbnVtYmVyLCBsb246IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gIHJldHVybiAoXHJcbiAgICBsYXQgPj0gNC41OCAmJlxyXG4gICAgbGF0IDw9IDIxLjEyICYmXHJcbiAgICBsb24gPj0gMTE2Ljk1ICYmXHJcbiAgICBsb24gPD0gMTI2LjZcclxuICApO1xyXG59XHJcbiJdfQ==